<div ng-form="myForm" class="form">

  <nav ng-if="report.livesave" id="page-menu" class="navbar navbar-inverse">
    <div class="navbar-header">
      <ul class="nav navbar-left top-nav">
        <li class="dropdown">
          <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-inbox"></i> &nbsp; Reports <b class="caret"></b></a>
          <ul class="dropdown-menu" role="menu">
            <li ng-if="report.id"><a href="javascript:;" ng-click="report.saveReport(false, myForm, report)"><i class="glyphicon glyphicon-save"></i> &nbsp; Save/View</a></li>
            <li><a href="#/reports/new"><i class="glyphicon glyphicon-plus"></i> &nbsp; New</a></li>
            <li><a href="#/reports"><i class="glyphicon glyphicon-search"></i> &nbsp; View All</a></li>
            <li ng-if="report.id" class="divider"></li>
            <li ng-if="report.id"><a href="javascript:;" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this report?<br> All work will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="report.deleteReport(report)"><i class="glyphicon glyphicon-trash text-danger"></i> &nbsp; Delete</a></li>
          </ul>
        </li>
        <li><a href="javascript:;" ng-click="report.saveReport(true, myForm, report)"><span ng-class="{'text-warning':myForm.$dirty}"><i class="glyphicon glyphicon-floppy-disk"></i> &nbsp; Save</span></a></li>
        <li><a href data-toggle="modal" data-target=".addTemplateModal"><i class="glyphicon glyphicon-plus"></i> &nbsp; Page</a></li>
        <li class="dropdown">
          <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-cog"></i> &nbsp; Options <b class="caret"></b></a>
          <ul class="dropdown-menu" role="menu">
            <li><span>Page</span></li>
            <li><span><label><input ng-model="report.allow_title" type="checkbox"> Add Title</label></span></li>
            <li ng-if="report.allow_title"><span><label><input ng-model="report.hideTitle" type="checkbox"> Hide Title</label></span></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  
  <div ng-class="{'paper-width':form.selectedOptions}">

    <ol ng-if="report.templates.length" class="breadcrumb edit-report-crumbs text-center" ng-init="setBreadcrumb(report.templates[0])">
      <li ng-repeat="template in report.templates"><a href="javascript:;" ng-click="setBreadcrumb(template)">{{template.name}}</a></li>
    </ol>

    <div ng-if="form.hideName==false" class="paper row">
      <h3>Page Name</h3>
      <input type="text" class="form-control" ng-model="form.name" placeholder="Start with a name then Save..."/>
    </div>

    <div ng-if="(report.hideTitle==false || report.viewing == true) && report.allow_title==true" class="paper row">
      <h3>Report Title</h3>
      <input class="form-control" type="text" ng-model="report.title">
    </div>

    <div ng-show="form.sections" class="paper row">

      <small ng-if="form.draft" class="pull-right">Draft</small>
      <a href="javascript:;" ng-if="report.editing" class="text-danger close pull-right" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this page from the report?<br><br>All information will be lost.</h4></center>" ng-bootbox-confirm-action="report.removeTemplate(form, report)"><i class="glyphicon glyphicon-remove"></i></a>
      <h1><center>{{form.name}}</center></h1>

      <div class="container-fluid section-row" ng-init="section[section_id].renaming = false" ng-class="{'no-highlight':!form.editing,'force-hover':form.selectedOptions.section_id == section_id+1 || section[section_id].renaming}" ng-repeat="(section_id, section_name) in form.sections track by $index">
        <div class="section-options" ng-show="form.editing">
          <a href="javascript:;" class="btn btn-default" ng-click="section[section_id].renaming = !section[section_id].renaming">
            <span ng-if="section[section_id].renaming != true">Rename</span>
            <span ng-if="section[section_id].renaming == true">Save Name</span>
          </a>
          &nbsp;
          <a href="javascript:;" class="btn btn-default" ng-click="form.moveSectionUp(form, section_id);myForm.$$parentForm.$dirty=true" ng-if="!$first"><i class="glyphicon glyphicon-arrow-up"></i></a>
          <a href="javascript:;" class="btn btn-default" ng-click="form.moveSectionDown(form, section_id);myForm.$$parentForm.$dirty=true" ng-if="!$last"><i class="glyphicon glyphicon-arrow-down"></i></a>
          <a href="javascript:;" class="text-danger close" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this section from the page?<br><br>The section's columns and fields will also be deleted and this is not reversible.</h4></center>" ng-bootbox-confirm-action="form.deleteSection(form, section_id, myForm.$$parentForm)"><i class="glyphicon glyphicon-remove"></i></a>
        </div>
        <h3>
          <span ng-if="section[section_id].renaming != true">{{section_name}}</span>
          <span ng-if="section[section_id].renaming == true"><input type="text" class="form-control" ng-model="form.sections[section_id]"></span>
        </h3>
        <hr ng-if="section_name">
        
        <div class="col-xs-12" ng-class="{'col-md-6':form.columns[section_id] == 2, 'col-md-4':form.columns[section_id] == 3}" ng-repeat="column in columnsArray(form.columns[section_id]) track by $index">
          <div ng-if="(report.livesave && report.editing) || report.viewing || (!report && form)" ng-click="form.setSelectedOptions(field, form)" ng-repeat="field in form.fields | filter:{column_id: $index+1, section_id: section_id+1}">
            <template-field-directive myForm="myForm" field="field" template="form" report="report"></template-field-directive>
          </div>
        </div>

      </div>

    </div>

  </div>

  <div ng-if="form.selectedOptions && !report" class="template-options">
    <nav ng-if="form.selectedOptions.fieldtype" class="navbar-inverse">
      <ul class="nav">
        <li class="navbar-text">
          <h4>Field Settings<small>
          <p><a href="javascript:;" class="btn btn-link" ng-click="form.setSelectedOptions(undefined, form)">Done</a></p>
            <p>{{form.selectedOptions.fieldtype | uppercase}}</p>
          </small></h4>
          <p>Field Label<input type="text" class="form-control" ng-model="form.selectedOptions.name"></p>
          <div>
            <p>Default Value
              <input ng-if="form.selectedOptions.fieldtype == 'date'" type="date" class="form-control" ng-model="form.selectedOptions.values[0].input">
              <input ng-if="form.selectedOptions.fieldtype == 'time'" type="time" class="form-control" ng-model="form.selectedOptions.values[0].input">
              <input ng-show="['checkbox','labelntext','textarea','date','time'].indexOf(form.selectedOptions.fieldtype) == -1" type="text" class="form-control" ng-model="form.selectedOptions.values[0].input">
              <input ng-show="form.selectedOptions.fieldtype == 'checkbox'" type="checkbox" class="form-control" ng-model="form.selectedOptions.values[0].input">
              <textarea ng-show="['labelntext','textarea'].indexOf(form.selectedOptions.fieldtype) != -1" class="form-control" ng-model="form.selectedOptions.values[0].input"></textarea>
            </p>
          </div>
          <div ng-show="form.selectedOptions.fieldtype != 'labelntext'">
            <p><input type="checkbox" ng-model="form.selectedOptions.required"/> Required</p>
            <p><input type="checkbox" ng-model="form.selectedOptions.disabled"/> Disabled</p>
          </div>
        </li>
      </ul>
      <ul class="nav" ng-show="form.selectedOptions.fieldtype == 'dropdown' || form.selectedOptions.fieldtype == 'radio'">
        <li class="navbar-text">
          <h4>Field Options<small>
            <p><a href="javascript:;" class="btn btn-link" ng-click="form.addOption(form.selectedOptions)">Add</a></p>
          </small></h4>
          <div class="input-group" ng-repeat="option in form.selectedOptions.options">
            <input type="text" class="form-control" ng-model="option.name">
            <span class="input-group-btn">
              <a href="javascript:;" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this option?<br><br>It will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="form.deleteOption(form.selectedOptions, option)">
                <i class="glyphicon glyphicon-remove"></i>
              </a>
            </span>
          </div>
        </li>
      </ul>
    </nav>
  </div>

</div>


<!-- BEGIN ADD TEMPLATE MODAL -->
<div ng-if="(report.livesave && report.template_order) || (!report.id && report.livesave)" class="modal fade addTemplateModal" tabindex="-1" role="dialog" aria-labelledby="previewModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h2 class="modal-title">Page Selection</h2>
      </div>
      <div class="modal-body row">
        <div>
          <div role="button" class="col-xs-4 col-md-3" data-dismiss="modal" ng-click="report.addTemplate(template, myForm, report)" ng-repeat-start="template in report.add_templates | orderBy:'id'">
            <ul class="list-group add-template-list">
              <li class="list-group-item"><h5>{{template.name}}</h5></li>
              <li class="list-group-item add-template-list-section col-xs-4">
                <label>Sections</label>
                <p ng-repeat="section_name in template.sections track by $index">{{section_name}}</p>
              </li>
            </ul>
          </div>
          <div class="container-fluid" ng-if="report.add_templates.length<1" ng-repeat-end>
            <h3>Nothing here?</h3>
            <p>Make sure the Page you want to add is not marked as Draft. Uncheck the "Draft" option when editing a Page, then save it.</p>
            <p>Pages may only be added to a report once.</p>
            <button class="btn btn-primary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- END ADD TEMPLATE MODAL -->