<div ng-form="myForm" class="form">
  
  <div ng-class="{'paper-width':(form.selectedOptions != undefined && form.editing) || report.templates, 'paper-height':report.templates}">

    <div ng-if="form.hideName==false" class="paper row">
      <h3>Page Name</h3>
      <input type="text" class="form-control" ng-model="form.name" placeholder="Start with a name then Save..."#/>
    </div>

    <div ng-if="report.hideTitle==false && report.allow_title==true" class="paper row">
      <div ng-if="report.editing">
        <h3>Report Title</h3>
        <input class="form-control" type="text" ng-model="report.title">
      </div>
      <h1 ng-if="report.viewing" class="text-center">{{report.title}}</h1>
    </div>

    <div ng-show="form.sections" class="paper row">
      <small ng-if="form.editing" class="pull-left">Click items to edit</small>
      <small ng-if="form.draft" class="pull-right">Draft</small>

      <a href="javascript:;" ng-if="report.editing" class="text-danger close pull-right" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this page from the report?<br><br>All information will be lost.</h4></center>" ng-bootbox-confirm-action="report.removeTemplate(form, report)"><i class="glyphicon glyphicon-remove"></i></a>

      <h1><center>{{form.name}}</center></h1>

      <div class="container-fluid section-row" ng-repeat="(section_id, section_name) in form.sections track by $index">

        <h3 ng-class="{'no-highlight':!form.editing,'force-hover':form.selectedOptions == section_id}" ng-click="form.selectedOptions=section_id" scroll-to=".force-hover" template="form">
          {{section_name}}
          <hr ng-if="section_name">
          <div ng-if="!section_name">
            <div ng-if="!form.editing">&nbsp;</div>
            <small ng-if="form.editing">Click to add a section name, or leave blank</small>
          </div>
        </h3>

        <div class="col-xs-12" ng-class="{'col-md-6':form.columns[section_id] == 2, 'col-md-4':form.columns[section_id] == 3}" ng-repeat="column in columnsArray(form.columns[section_id]) track by $index">

          <div ng-click="form.setSelectedOptions(field, form)" ng-repeat="field in form.fields | filter:{column_id: $index+1, section_id: section_id+1} | orderBy:'column_order'" scroll-to=".force-hover" template="form">
            <template-field-directive myForm="myForm" field="field" template="form" report="report"></template-field-directive>
          </div>

        </div>

        <p class="clearfix"><div ng-if="!form.editing">&nbsp;</div><a href="javascript:;" ng-if="form.editing" ng-click="form.newSectionAdd=false;form.newFieldAdd=true;form.newFieldSection=section_id" scroll-to="#page_additions" template="form">Add field to {{section_name}}<span ng-if="!section_name">this section</span></a></p>

      </div>

    </div>

  </div>

  <!-- RIGHT SIDEBAR -->
  <div id="right-sidebar" ng-show="(form.selectedOptions != undefined && form.editing) || report.templates" class="template-options" ng-class="{'report-pages':report}">

    <!-- REPORT PAGES DESKTOP -->
    <nav ng-if="report.templates">
      <ul class="nav">
        <li class="navbar-text">
          <h3>Pages</h3>
          <ul class="list-unstyled">
            <li class="navbar-text"><p ng-repeat="template in report.templates"><a href="javascript:;" ng-class="{'selected':template==form}" ng-click="setBreadcrumb(template)">{{template.name}}</a></p></li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- SECTION OPTIONS -->
    <nav ng-if="!report && !form.selectedOptions.fieldtype">
      <ul class="nav">
        <li class="navbar-text">
          <h3>SECTION</h3>
          <p class="clearfix">
            <a href="javascript:;" class="btn btn-success" ng-click="form.setSelectedOptions(undefined, form)"><i class="glyphicon glyphicon-ok"></i> &nbsp; Done</a>
          </p>

          <label>Name</label>
          <p>
            <input type="text" class="form-control" ng-model="form.sections[form.selectedOptions]">
          </p>

          <label>Columns</label>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-primary" ng-disabled="form.columns[form.selectedOptions] <= 1" ng-click="form.deleteSectionColumn(form, form.selectedOptions, myForm.$$parentForm)"><i class="glyphicon glyphicon-minus"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-disabled="true">{{form.columns[form.selectedOptions]}}</a>
            <a href="javascript:;" class="btn btn-primary" ng-disabled="form.columns[form.selectedOptions] >= 3" ng-click="form.addSectionColumn(form, form.selectedOptions, myForm.$$parentForm)"><i class="glyphicon glyphicon-plus"></i></a>
          </p>

          <label>Order</label>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-click="form.moveSection(form, form.selectedOptions, 'up');myForm.$$parentForm.$dirty=true"><i class="glyphicon glyphicon-arrow-up"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-click="form.moveSection(form, form.selectedOptions, 'down');myForm.$$parentForm.$dirty=true"><i class="glyphicon glyphicon-arrow-down"></i></a>
          </p>
        </li>
      </ul>

      <ul class="nav">
        <li class="navbar-text">
          &nbsp;
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this section from the page?<br><br>The section's columns and fields will also be deleted and this is not reversible.</h4></center>" ng-bootbox-confirm-action="form.deleteSection(form, form.selectedOptions, myForm.$$parentForm)">Delete Section</a>
          </p>
        </li>
      </ul>

    </nav>

    <!-- FIELD OPTIONS -->
    <nav ng-if="!report && form.selectedOptions.fieldtype">

      <ul class="nav">
        <li class="navbar-text">
          <h3>{{form.selectedOptions.fieldtype | uppercase}}</h3>
          <p class="clearfix">
            <a href="javascript:;" class="btn btn-success" ng-click="form.setSelectedOptions(undefined, form)"><i class="glyphicon glyphicon-ok"></i> &nbsp; Done</a>
          </p>

          <label>Name</label>
          <p>
            <input type="text" class="form-control" ng-model="form.selectedOptions.name">
          </p>

          <label>Default Value</label>
          <p>
            <input ng-if="form.selectedOptions.fieldtype == 'integer'" type="number" class="form-control" ng-model="form.selectedOptions.default_value">
            <input ng-if="form.selectedOptions.fieldtype == 'date'" type="date" class="form-control" ng-model="form.selectedOptions.default_value">
            <input ng-if="form.selectedOptions.fieldtype == 'time'" type="time" class="form-control" ng-model="form.selectedOptions.default_value">
            <input ng-show="['checkbox','labelntext','textarea','date','time','integer'].indexOf(form.selectedOptions.fieldtype) == -1" type="text" class="form-control" ng-model="form.selectedOptions.default_value">
            <input ng-show="form.selectedOptions.fieldtype == 'checkbox'" type="checkbox" class="form-control" ng-model="form.selectedOptions.default_value">
            <textarea ng-show="['labelntext','textarea'].indexOf(form.selectedOptions.fieldtype) != -1" class="form-control" ng-model="form.selectedOptions.default_value"></textarea>
          </p>

          <label>Column</label>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':$index+1==form.selectedOptions.column_id}" ng-click="form.changeFieldColumn(form, form.selectedOptions, $index+1);myForm.$$parentForm.$dirty=true" ng-repeat="column in columnsArray(form.columns[form.selectedOptions.section_id-1]) track by $index">{{$index+1}}</a>
          </p>

          <label>Order</label>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-click="form.moveField(form, form.selectedOptions, 'up');myForm.$$parentForm.$dirty=true"><i class="glyphicon glyphicon-arrow-up"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-click="form.moveField(form, form.selectedOptions, 'down');myForm.$$parentForm.$dirty=true"><i class="glyphicon glyphicon-arrow-down"></i></a>
          </p>

          <div ng-show="form.selectedOptions.fieldtype != 'labelntext'">
            <label>Required</label>
            <p class="btn-group btn-group-justified" ng-click="form.selectedOptions.required = !form.selectedOptions.required;myForm.$$parentForm.$dirty=true">
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':form.selectedOptions.required}">Yes</a>
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':!form.selectedOptions.required}">No</a>
            </p>

            <label>Disabled</label>
            <p class="btn-group btn-group-justified" ng-click="form.selectedOptions.disabled = !form.selectedOptions.disabled;myForm.$$parentForm.$dirty=true">
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':form.selectedOptions.disabled}">Yes</a>
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':!form.selectedOptions.disabled}">No</a>
            </p>
          </div>

        </li>
      </ul>

      <ul class="nav" ng-if="form.selectedOptions.fieldtype == 'dropdown' || form.selectedOptions.fieldtype == 'radio'">
        <li class="navbar-text">
          <h4>
            <p>Options</p>
            <small><p class="clearfix"><a href="javascript:;" class="btn btn-default" ng-click="form.addOption(form.selectedOptions);myForm.$$parentForm.$dirty=true"><i class="glyphicon glyphicon-plus"></i> &nbsp; Add</a></p></small>
          </h4>
          <div class="input-group" ng-repeat="option in form.selectedOptions.options track by $index">
            <input type="text" class="form-control" ng-model="form.selectedOptions.options[$index]">
            <span class="input-group-btn">
              <a href="javascript:;" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this option?<br><br>It will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="form.deleteOption(form.selectedOptions, option, form, myForm.$$parentForm)">
                <i class="glyphicon glyphicon-remove"></i>
              </a>
            </span>
          </div>
        </li>
      </ul>

      <ul class="nav">
        <li class="navbar-text">
          &nbsp;
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this field?<br><br>It will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="form.deleteField(form, form.selectedOptions, myForm.$$parentForm)">Delete Field</a>
          </p>
        </li>
      </ul>
    
    </nav>
  </div>

</div>