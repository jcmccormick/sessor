<div ng-form="myForm" class="form">
  <div ng-class="{'paper-width':form.selectedOptions != undefined && form.editing}">

    <div ng-if="form.hideName==false && !report" class="paper row">
      <div class="col-xs-12">
        <input type="text" class="form-control imod" placeholder="Enter Name then Save" ng-model="form.name">
      </div>
    </div>

    <div ng-if="report.hideTitle==false && report.allow_title==true" class="paper row">
      <div class="col-xs-12">
        <input ng-if="!report.viewing" type="text" class="form-control imod" placeholder="Title" ng-model="report.title">
        <h1 ng-if="report.viewing" class="text-center">{{report.title}}</h1>
      </div>
    </div>

    <div ng-show="form.sections" class="paper row">
      <h4 class="col-xs-12">
        <small ng-show="form.draft"><b>Draft</b></small>
        &nbsp;
        <a href="javascript:;" ng-show="report.editing" class="text-danger close pull-right" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this page from the report?<br><br>All information will be lost.</h4></center>" ng-bootbox-confirm-action="report.removeTemplate(form, report)">&times;</a>
      </h4>

      <div class="col-xs-10 col-xs-offset-1 col-md-8 col-md-offset-2">
        <h1><center>{{form.name}}</center></h1>
      </div>


      <div class="col-xs-12">
        <h4 ng-if="form.editing">
          <a href="javascript:;" ng-click="form.addSection(form)" scroll-to=".force-hover" template="form">
            <i class="glyphicon glyphicon-plus-sign"></i> Add Section
          </a>
        </h4>
        <h4 ng-if="!form.editing">&nbsp;</h4>
      </div>

      <div class="col-xs-12 section-row" ng-repeat="(section_id, section_name) in form.sections track by $index" ng-class="{'stay-open':!form.fields.length || form.selectedOptions.section_id == section_id+1 || form.selectedOptions == section_id}">
        <div class="col-xs-12">
          <h2 ng-class="{'no-highlight':!form.editing,'force-hover':form.selectedOptions == section_id}" ng-click="form.selectedOptions=section_id" scroll-to=".force-hover" template="form">
            {{section_name}}
            <span ng-if="!section_name">
              <span ng-if="!form.editing">&nbsp;</span>
              <small><a href="javascript:;" ng-if="form.editing">Add a section name, or leave blank</a></small>
            </span>
          </h2>
        </div>
        <div class="col-xs-12">
          <div class="col-xs-12 section-layout" ng-if="form.editing">
              <a href="javascript:;" class="btn btn-primary" ng-disabled="form.columns[section_id] <= 1" ng-click="form.deleteSectionColumn(form, section_id, myForm.$$parentForm)"><i class="glyphicon glyphicon-minus"></i></a>
              <a href="javascript:;" disabled="true">Columns</a>
              <a href="javascript:;" class="btn btn-primary" ng-disabled="form.columns[section_id] >= 3" ng-click="form.addSectionColumn(form, section_id, myForm.$$parentForm)"><i class="glyphicon glyphicon-plus"></i></a>
              <a href="javascript:;" class="btn btn-default" ng-click="form.moveSection(form, section_id, 'up');myForm.$$parentForm.$dirty=true" scroll-to=".force-hover" template="form"><i class="glyphicon glyphicon-arrow-up"></i></a>
              <a href="javascript:;" disabled="true">Order</a>
              <a href="javascript:;" class="btn btn-default" ng-click="form.moveSection(form, section_id, 'down');myForm.$$parentForm.$dirty=true" scroll-to=".force-hover" template="form"><i class="glyphicon glyphicon-arrow-down"></i></a>
          </div>
        </div>  
        <div class="col-xs-12 column" ng-class="{'col-md-6':form.columns[section_id] == 2, 'col-md-4':form.columns[section_id] == 3}" ng-repeat="column in columnsArray(form.columns[section_id]) track by $index">

          <div ng-click="form.setSelectedOptions(field, form)" ng-repeat="field in form.fields | filter:{column_id: $index+1, section_id: section_id+1} | orderBy:'column_order'">
            <template-field-directive myForm="myForm" field="field" template="form" report="report"></template-field-directive>
          </div>

          <div class="add-field-slide" ng-if="form.editing">
            <h4 class="col-xs-12"><strong>New Field</strong> {{section_name || 'Section '+(section_id*1+1)}}, Column {{$index+1}} <small class="pull-right"><i class="glyphicon glyphicon-chevron-up"></i></small></h4>
            <div class="col-xs-4 text-center h6">
              <input type="text" class="form-control" placeholder="Name" ng-model="form.newFieldName">
              <h4>or</h4>
              <input type="text" class="form-control" placeholder="Placeholder" ng-model="form.newFieldPlaceholder">
            </div>
            <a href="javascript:;" class="btn" ng-repeat="type in form.addFieldTypes" ng-click="form.addField(form, 1*section_id+1, $parent.$index+1, type, form.newFieldName, form.newFieldPlaceholder, myForm.$$parentForm);form.newFieldAdd=false" scroll-to=".force-hover" template="form">
              <i class="glyphicon {{type.glyphicon}}"></i> {{type.value}}
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>