<md-card ng-cloak>
    <md-toolbar class="md-site-secondary">
        <div class="md-toolbar-tools">
            <h2>
                <span>All Reports</span>
            </h2>
            <span flex></span>
            <md-button href="/templates/new" class="md-fab md-mini md-site-primary" aria-label="new report">
                <md-tooltip md-direction="left">
                    New Report
                </md-tooltip>
                <md-icon>add</md-icon>
            </md-button>
        </div>
    </md-toolbar>

    <div class="md-padding">
        <div layout="row">
            <md-input-container flex>
                <label>Search</label>
                <input ng-model="vr.keywords" ng-change="vt.currentPage = 0">
            </md-input-container>
            <span flex></span>
            <md-button class="md-icon-button md-primary" ng-repeat="distance in [10, 25, 50, 100]" ng-click="vr.pageSize = distance; vr.currentPage = 0" aria-label="{{distance}} entries per page">
                <md-tooltip md-direction="bottom">
                    entries per page
                </md-tooltip>
                {{distance}}
            </md-button>
            <md-button class="md-icon-button md-primary" ng-class="{'disabled':vr.currentPage==0}" ng-click="vr.currentPage = vr.currentPage-1" aria-label="back 1 page">
                <md-tooltip md-direction="bottom">
                    Back 1 page
                </md-tooltip>
                <md-icon>chevron_left</md-icon>
            </md-button>
            <h4><span>{{(vr.filteredList.length && vr.currentPage+1) || 0}} of {{vr.filteredList.length && vr.numPages() || 0}}</span></h4>
            <md-button class="md-icon-button md-primary" ng-class="{'disabled':vr.filteredList.length && vr.currentPage>=vt.numPages()-1}" ng-click="vr.currentPage = vr.currentPage+1" aria-label="forward 1 page">
                <md-tooltip md-direction="bottom">
                    Forward 1 page
                </md-tooltip>
                <md-icon>chevron_right</md-icon>
            </md-button>
        </div>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th ng-click="vr.sortType = 'id'; vr.sortReverse = !vr.sortReverse" aria-label="sort reports by id">ID &nbsp; 
                    <md-icon ng-show="vr.sortType=='id' && !vr.sortReverse">expand_more</md-icon> 
                    <md-icon ng-show="vr.sortType=='id' && vr.sortReverse">expand_less</md-icon>
                </th>
                <th ng-click="vr.sortType = 'title'; vr.sortReverse = !vr.sortReverse" aria-label="sort reports by name">Name &nbsp; 
                    <md-icon ng-show="vr.sortType=='title' && !vr.sortReverse">expand_more</md-icon> 
                    <md-icon ng-show="vr.sortType=='title' && vr.sortReverse">expand_less</md-icon>
                </th>
                <th ng-click="vr.sortType = 'templates[0].name'; vr.sortReverse = !vr.sortReverse" aria-label="sort reports by pages">Pages &nbsp;
                    <md-icon ng-show="vr.sortType=='templates[0].name' && !vr.sortReverse">expand_more</md-icon> 
                    <md-icon ng-show="vr.sortType=='templates[0].name' && vr.sortReverse">expand_less</md-icon>
                </th>
                <th ng-click="vr.sortType = 'updated_at'; vr.sortReverse = !vr.sortReverse" aria-label="sort reports by updated time">Updated &nbsp; 
                    <md-icon ng-show="vr.sortType=='updated_at' && !vr.sortReverse">expand_more</md-icon> 
                    <md-icon ng-show="vr.sortType=='updated_at' && vr.sortReverse">expand_less</md-icon>
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody ng-if="vr.reports.length">
            <tr ng-repeat="report in vr.filteredList = (vr.reports | filter:vr.keywords) | orderBy:vr.sortType:vr.sortReverse | startFrom:vr.currentPage*vr.pageSize | limitTo: vr.pageSize">
                <td>{{report.id}}</td>
                <td>{{report.title || 'Untitled'}}</td>
                <td><span ng-repeat="template in report.templates track by $index">{{template.name}}<span ng-show="!$last">, </span></span></td>
                <td>{{report.updated_at | date: 'short'}}</td>
                <td>
                    <md-content layout="row" layout-align="end center">
                        <md-button href="/reports/{{report.id}}" class="md-icon-button md-primary" aria-label="view {{report.id}} {{report.title || 'untitled'}}">
                            <md-tooltip md-direction="bottom">
                                View {{report.id}} {{report.title || 'untitled'}}
                            </md-tooltip>
                            <md-icon>search</md-icon>
                        </md-button> 
                        <md-button href="/reports/{{report.id}}/edit" class="md-icon-button md-primary" aria-label="edit {{report.id}} {{report.title || 'untitled'}}">
                            <md-tooltip md-direction="bottom">
                                Edit {{report.id}} {{report.title || 'untitled'}}
                            </md-tooltip>
                            <md-icon>create</md-icon>
                        </md-button>
                        <md-button ng-click="vr.delete(report, $event)" class="md-icon-button md-warn" aria-label="delete {{report.id}} {{report.title || 'untitled'}}">
                            <md-tooltip md-direction="bottom">
                                Delete {{report.id}} {{report.title || 'untitled'}}
                            </md-tooltip>
                            <md-icon>delete</md-icon>
                        </md-button>
                    </md-content>
                </td>
            </tr>
        </tbody>
    </table>
</md-card>