<div ng-form="tempForm">
  <page-menu>
    <li class="dropdown">
      <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-file"></i> &nbsp; Pages <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href ng-click="vt.template.saveTemplate(false, tempForm, vt.template)" ng-if="vt.template.id"><i class="glyphicon glyphicon-save"></i> &nbsp; Save/View</a></li>
        <li><a href="#/templates/new"><i class="glyphicon glyphicon-plus"></i> &nbsp; New</a></li>
        <li><a href="#/templates"><i class="glyphicon glyphicon-search"></i> &nbsp; View All</a></li>
        <li ng-if="vt.template.id" class="divider"></li>
        <li><a href ng-if="vt.template.id" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this page?<br> All work will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="vt.template.deleteTemplate(vt.template)"><i class="glyphicon glyphicon-trash text-danger"></i> &nbsp; Delete</a></li>
      </ul>
    </li>
    <li><a href ng-click="vt.template.saveTemplate(true, tempForm, vt.template)"><span ng-class="{'text-warning':tempForm.$dirty}"><i class="glyphicon glyphicon-floppy-disk"></i> &nbsp; Save</span></a></li>
    <li class="dropdown" ng-if="vt.template.id">
      <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-plus"></i> &nbsp; Add <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href data-toggle="modal" data-target=".newSectionModal"><i class="glyphicon glyphicon-modal-window"></i> &nbsp; Section</a></li>
        <li ng-repeat-start="type in vt.fields"><a href ng-click="vt.template.setFieldType(type, vt.template)" ng-class="{disabled:vt.template.sections.length<1}" data-toggle="modal" data-target=".newFieldModal"><i class="glyphicon {{type.glyphicon}}"></i> &nbsp; {{type.value}}</a></li>
        <li ng-repeat-end class="divider" ng-if="['labelntext','email','time'].indexOf(type.name) != -1"></li>
      </ul>
    </li>
    <li class="dropdown" ng-if="vt.template.id">
      <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-cog"></i> &nbsp; Options <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><span>Page</span></li>
        <li><span><label><input ng-model="vt.template.hideName" type="checkbox"> Hide Name</span></li>
        <li><span><label for="template_draft"><input type="checkbox" id="template_draft" name="template_draft" ng-model="vt.template.draft"> Draft</label></span></li>
        <li class="divider"></li>
        <li><span>Sharing</span></li>
        <li><span><label for="private_world"><input type="checkbox" id="private_world" name="private_world" ng-model="vt.template.private_world"> Share Public</label></span></li>
        <li><span><label for="private_group"><input type="checkbox" id="private_group" name="private_group" ng-model="vt.template.private_group"> Share Group</label></span></li>
        <div ng-if="vt.template.private_group == 1">
          <li class="divider"></li>
          <li><span>Group</span></li>
          <li><span><label for="group_edit"><input type="checkbox" id="group_edit" name="group_edit" ng-model="vt.template.group_edit"> Allow Editing</label></span></li>
          <div ng-if="vt.template.group_edit">
            <li><span>Editors</span></li>
            <li><span><a role="button">Add</a> / <a role="button">Remove</a></span></li>
          </div>
        </div>
      </ul>
    </li>
  </page-menu>

  <template-form-directive form="vt.template"></template-form-directive>
</div>

<!-- BEGIN NEW SECTION MODAL -->
<div class="modal fade newSectionModal" tabindex="-1" role="dialog" aria-labelledby="newSectionModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Section Design</h4>
      </div>
      <div class="modal-body">
        <h4>Title <small>OPTIONAL</small></h4>
        <input type="text" class="form-control" ng-model="vt.template.newSectionName" value="{{section_name}}">

        <h4>Columns <small>CHOOSE ONE</small></h4>
        <ul class="btn-group btn-group-justified list-unstyled">
          <li class="btn btn-default" data-dismiss="modal" ng-repeat="column in [1,2,3]" ng-click="vt.template.addNewSection(vt.template.newSectionName, column, tempForm, vt.template)">
            {{column}}
          </li>
        </ul>
      </div>
    </form>
  </div>
</div>
<!-- END NEW SECTION MODAL -->

<!-- BEGIN NEW FIELD MODAL -->
<div class="modal fade newFieldModal" tabindex="-1" role="dialog" aria-labelledby="newFieldModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form name="newFieldForm" class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Field Design</h4>
      </div>
      <div class="modal-body">
        <h4>Field Name <small>REQUIRED</small></h4>
        <input type="text" class="form-control" ng-model="vt.template.newFieldName" required>

        <h4>Section</h4>
        <select class="form-control" ng-model="newFieldSection" ng-options="key as value for (key, value) in vt.template.sections">
          <option value="">Select Section</option>
        </select>
        
        <div ng-show="newFieldSection && newFieldSection+1>0 && vt.template.newFieldName">
          <h4>Column</h4>
          <ul class="btn-group btn-group-justified list-unstyled">
            <li class="btn btn-default" data-dismiss="modal" ng-click="vt.template.addNewField(vt.template, 1*newFieldSection+1, $index+1, vt.template.newFieldType, vt.template.newFieldName)" ng-repeat="column_id in vt.template.countColumns(vt.template.columns[newFieldSection]) track by $index">
              Column {{$index+1}}
            </li>
          </ul>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- END NEW FIELD MODAL -->