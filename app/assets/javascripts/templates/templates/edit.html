<div ng-form="vt.tempForm" class="form">
  <page-menu>
    <li class="dropdown">
      <a href class="dropdown-toggle" data-toggle="dropdown">Pages <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href ng-click="vt.template.saveTemplate(false, vt.tempForm, vt.template)" ng-if="vt.template.id"><i class="glyphicon glyphicon-save"></i> &nbsp; Save/View</a></li>
        <li><a href="#/templates/new"><i class="glyphicon glyphicon-plus"></i> &nbsp; New</a></li>
        <li><a href="#/templates"><i class="glyphicon glyphicon-search"></i> &nbsp; View All</a></li>
        <li ng-if="vt.template.id" class="divider"></li>
        <li><a href ng-if="vt.template.id" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this page?<br> All work will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="vt.template.deleteTemplate(vt.template)"><i class="glyphicon glyphicon-trash text-danger"></i> &nbsp; Delete</a></li>
      </ul>
    </li>
    <li><a href ng-click="vt.template.saveTemplate(true, vt.tempForm, vt.template)"><span ng-class="{'save-now':vt.tempForm.$dirty || myForm.$dirty}">Save</span></a></li>
    <li class="dropdown" ng-if="vt.template.id">
      <a href class="dropdown-toggle" data-toggle="dropdown">Add <b class="caret"></b></a>
      <ul class="dropdown-menu bump-left">
        <li><a href="javascript:;" ng-click="vt.template.newSectionAdd=true;vt.template.newFieldAdd=false" scroll-to="#page_additions" template="vt.template"><i class="glyphicon glyphicon-modal-window"></i> &nbsp; Section</a></li>
        <li ng-repeat-start="type in vt.template.addFieldTypes"><a href="javascript:;" ng-click="vt.template.setFieldType(type, vt.template);vt.template.newFieldAdd=true;vt.template.newSectionAdd=false" ng-class="{disabled:vt.template.sections.length<1}" scroll-to="#page_additions" template="vt.template"><i class="glyphicon {{type.glyphicon}}"></i> &nbsp; {{type.value}}</a></li>
        <li ng-repeat-end class="divider" ng-if="['labelntext','email','time'].indexOf(type.name) != -1"></li>
      </ul>
    </li>
    <li class="dropdown" ng-if="vt.template.id">
      <a href class="dropdown-toggle" data-toggle="dropdown">Options <b class="caret"></b></a>
      <ul class="dropdown-menu bump-left">
        <li><span>Page</span></li>
        <li><span><label><input ng-model="vt.template.hideName" type="checkbox"> Hide Name</span></li>
        <li><span><label for="template_draft"><input type="checkbox" id="template_draft" name="template_draft" ng-model="vt.template.draft"> Draft</label></span></li>
        <li class="divider"></li>
        <li><span>Sharing</span></li>
        <li><span><label for="private_world"><input type="checkbox" id="private_world" name="private_world" ng-model="vt.template.private_world"> Share Public</label></span></li>
        <li><span><label for="private_group"><input type="checkbox" id="private_group" name="private_group" ng-model="vt.template.private_group"> Share Group</label></span></li>
        <div ng-if="vt.template.private_group == 1">
          <li class="divider"></li>
          <li><span>Group</span></li>
          <li><span><label for="group_edit"><input type="checkbox" id="group_edit" name="group_edit" ng-model="vt.template.group_edit"> Allow Editing</label></span></li>
          <div ng-if="vt.template.group_edit">
            <li><span>Editors</span></li>
            <li><span><a role="button">Add</a> / <a role="button">Remove</a></span></li>
          </div>
        </div>
      </ul>
    </li>
  </page-menu>

  <div ng-if="vt.template.id" ng-class="{'paper-width':vt.template.selectedOptions != undefined}" id="page_additions">
    <!-- BEGIN NEW SECTION ADD -->
    <div ng-if="vt.template.newSectionAdd==true || !vt.template.sections.length" class="paper row">
      <div class="col-xs-12">
        <button type="button" class="close" ng-if="vt.template.newSectionAdd && vt.template.sections.length" ng-click="vt.template.newSectionAdd=false" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3>Add Section</h3>
  
        <h4>Name <small>OPTIONAL</small></h4>
        <input type="text" class="form-control page_addition" ng-model="vt.template.newSectionName" value="{{section_name}}">
  
        <h4>Columns <small>REQUIRED</small></h4>
        <ul class="btn-group btn-group-justified list-unstyled">
          <li class="btn btn-default" ng-repeat="column in [1,2,3]" ng-click="vt.template.addSection(vt.template.newSectionName, column, vt.tempForm, vt.template);vt.template.newSectionAdd=false" scroll-to=".force-hover" template="vt.template">
            {{column}}
          </li>
        </ul>
      </div>
    </div>
    <!-- END NEW SECTION ADD -->

    <!-- BEGIN NEW FIELD ADD -->
    <div ng-if="vt.template.newFieldAdd" class="paper row">
      <div class="col-xs-12">
        <button type="button" class="close" ng-click="vt.template.newFieldAdd=false" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3>Add {{vt.template.newFieldType.value}}</h3>
        <small>ALL REQUIRED</small>
  
        <h4>Name</h4>
        <input type="text" class="form-control page_addition" ng-model="vt.template.newFieldName" required>
  
        <h4>Type</h4>
        <ul class="list-inline">
          <li ng-repeat="type in vt.template.addFieldTypes" class="text-center" ng-click="vt.template.newFieldType=type">
            <a href="javascript:;" class="btn" ng-class="{'btn-primary':vt.template.newFieldType == type}">
              <i class="glyphicon {{type.glyphicon}}"></i> &nbsp; {{type.value}}
            </a>
          </li>
        </ul>
  
        <h4>Section</h4>
        <a href="javascript:;" class="btn" ng-class="{'btn-primary':vt.template.newFieldSection==$index}" ng-repeat="section in vt.template.sections track by $index" ng-click="vt.template.newFieldSection=$index">{{section}} <span ng-if="!section">Section {{$index+1}}</span></a>
        
        <div ng-show="vt.template.newFieldSection + 1 > 0 && vt.template.newFieldName && vt.template.newFieldType">
          <h4>Column</h4>
          <ul class="btn-group btn-group-justified list-unstyled">
            <li class="btn btn-default" ng-repeat="column_id in vt.template.countColumns(vt.template.columns[vt.template.newFieldSection]) track by $index" ng-click="vt.template.addField(vt.template, 1*vt.template.newFieldSection+1, $index+1, vt.template.newFieldType, vt.template.newFieldName, vt.tempForm);vt.template.newFieldAdd=false" scroll-to=".force-hover" template="vt.template">
              Column {{$index+1}}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- END NEW FIELD ADD -->
  </div>

  <template-form-directive form="vt.template"></template-form-directive>

  <!-- RIGHT SIDEBAR -->
  <div id="right-sidebar" ng-if="vt.template.selectedOptions != undefined && vt.template.editing" ng-init="vt.template.optionsDropOut = 'general'" class="template-options">

    <div class="col-xs-12">

      <div class="options-header" ng-class="{'active':vt.template.optionsDropOut=='general'}" ng-click="vt.template.optionsDropOut = 'general'">
        <h3>General <small><i class="glyphicon glyphicon-chevron-left"></i><a href="javascript:;" class="close" ng-click="vt.template.setSelectedOptions(undefined, vt.template)">Close</a></small></h3>
      </div>
      <div ng-if="vt.template.optionsDropOut == 'general'">
        <h4>Type</h4>
        <p>&nbsp; {{(vt.template.selectedOptions.fieldtype | uppercase) || 'SECTION'}}</p>

        <!-- SECTION GENERAL -->
        <div ng-if="!vt.template.selectedOptions.fieldtype">
          <h4>Name</h4>
          <input type="text" class="form-control" ng-model="vt.template.sections[vt.template.selectedOptions]">
        </div>


        <!-- FIELD GENERAL -->
        <div ng-if="vt.template.selectedOptions.fieldtype">

          <h4>Name</h4>
          <input type="text" class="form-control" ng-model="vt.template.selectedOptions.name">

          <h4>Default Value</h4>
          <p class="clearfix">
            <input ng-if="vt.template.selectedOptions.fieldtype == 'integer'" type="number" class="form-control" ng-model="vt.template.selectedOptions.default_value">
            <input ng-if="vt.template.selectedOptions.fieldtype == 'date'" type="date" class="form-control" ng-model="vt.template.selectedOptions.default_value">
            <input ng-if="vt.template.selectedOptions.fieldtype == 'time'" type="time" class="form-control" ng-model="vt.template.selectedOptions.default_value">
            <input ng-show="['checkbox','labelntext','textarea','date','time','integer'].indexOf(vt.template.selectedOptions.fieldtype) == -1" type="text" class="form-control" ng-model="vt.template.selectedOptions.default_value">
            <input ng-show="vt.template.selectedOptions.fieldtype == 'checkbox'" type="checkbox" class="imod" ng-model="vt.template.selectedOptions.default_value">
            <textarea ng-show="['labelntext','textarea'].indexOf(vt.template.selectedOptions.fieldtype) != -1" class="form-control" ng-model="vt.template.selectedOptions.default_value"></textarea>
          </p>

          <div class="h4" ng-show="vt.template.selectedOptions.fieldtype != 'labelntext'">
            <h4>Required</h4>
            <p class="btn-group btn-group-justified" ng-click="vt.template.selectedOptions.required = !vt.template.selectedOptions.required;vt.tempForm.$dirty=true">
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':vt.template.selectedOptions.required}">Yes</a>
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':!vt.template.selectedOptions.required}">No</a>
            </p>

            <h4>Disabled</h4>
            <p class="btn-group btn-group-justified" ng-click="vt.template.selectedOptions.disabled = !vt.template.selectedOptions.disabled;vt.tempForm.$dirty=true">
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':vt.template.selectedOptions.disabled}">Yes</a>
              <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':!vt.template.selectedOptions.disabled}">No</a>
            </p>
          </div>
        </div>
        <hr />
      </div>

      <div class="options-header" ng-class="{'active':vt.template.optionsDropOut=='layout'}" ng-click="vt.template.optionsDropOut = 'layout'">
        <h3>Layout <small><i class="glyphicon glyphicon-chevron-left"></i></small></h3>
      </div>
      <div ng-if="vt.template.optionsDropOut == 'layout'">

        <!-- SECTION LAYOUT -->
        <div ng-if="!vt.template.selectedOptions.fieldtype">
          <h4>Columns</h4>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-primary" ng-disabled="vt.template.columns[vt.template.selectedOptions] <= 1" ng-click="vt.template.deleteSectionColumn(vt.template, vt.template.selectedOptions, vt.tempForm)"><i class="glyphicon glyphicon-minus"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-disabled="true">{{vt.template.columns[vt.template.selectedOptions]}}</a>
            <a href="javascript:;" class="btn btn-primary" ng-disabled="vt.template.columns[vt.template.selectedOptions] >= 3" ng-click="vt.template.addSectionColumn(vt.template, vt.template.selectedOptions, vt.tempForm)"><i class="glyphicon glyphicon-plus"></i></a>
          </p>

          <h4>Order</h4>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-click="vt.template.moveSection(vt.template, vt.template.selectedOptions, 'up');vt.tempForm.$dirty=true" scroll-to=".force-hover" template="vt.template"><i class="glyphicon glyphicon-arrow-up"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-click="vt.template.moveSection(vt.template, vt.template.selectedOptions, 'down');vt.tempForm.$dirty=true" scroll-to=".force-hover" template="vt.template"><i class="glyphicon glyphicon-arrow-down"></i></a>
          </p>
        </div>

        <!-- FIELD LAYOUT -->
        <div ng-if="vt.template.selectedOptions.fieldtype">
          <h4>Section</h4>
          <select class="form-control" ng-options="section_id*1+1 as section_name for (section_id, section_name) in vt.template.sections" ng-model="vt.template.selectedOptions.section_id" ng-change="vt.template.changeFieldSection(vt.template, vt.template.selectedOptions, '{{vt.template.selectedOptions.section_id}}')"></select>

          <h4>Column</h4>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-class="{'btn-primary':$index+1==vt.template.selectedOptions.column_id}" ng-click="vt.template.changeFieldColumn(vt.template, vt.template.selectedOptions, $index+1);vt.tempForm.$dirty=true" ng-repeat="column in vt.template.countColumns(vt.template.columns[vt.template.selectedOptions.section_id-1]) track by $index" scroll-to=".force-hover" template="vt.template">{{$index+1}}</a>
          </p>

          <h4>Order</h4>
          <p class="btn-group btn-group-justified">
            <a href="javascript:;" class="btn btn-default" ng-click="vt.template.moveField(vt.template, vt.template.selectedOptions, 'up');vt.tempForm.$dirty=true" scroll-to=".force-hover" template="vt.template"><i class="glyphicon glyphicon-arrow-up"></i></a>
            <a href="javascript:;" class="btn btn-default" ng-click="vt.template.moveField(vt.template, vt.template.selectedOptions, 'down');vt.tempForm.$dirty=true" scroll-to=".force-hover" template="vt.template"><i class="glyphicon glyphicon-arrow-down"></i></a>
          </p>
        </div>
        <hr />
      </div>

      <!-- FIELD OPTIONS -->
      <div class="options-header" ng-if="vt.template.selectedOptions.fieldtype == 'dropdown' || vt.template.selectedOptions.fieldtype == 'radio'" ng-class="{'active':vt.template.optionsDropOut=='options'}" ng-click="vt.template.optionsDropOut = 'options'">
        <h3>Options <small><i class="glyphicon glyphicon-chevron-left"></i></small></h3>
      </div>
      <div ng-if="vt.template.optionsDropOut == 'options'">
        <h4><a href="javascript:;" ng-click="vt.template.addOption(vt.template.selectedOptions);vt.tempForm.$dirty=true">Add New</a></h4>
        <div class="input-group" ng-repeat="option in vt.template.selectedOptions.options track by $index">
          <input type="text" class="form-control" ng-model="vt.template.selectedOptions.options[$index]">
          <span class="input-group-btn">
            <a href="javascript:;" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this option?<br><br>It will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="vt.template.deleteOption(vt.template.selectedOptions, option, vt.template, vt.tempForm)">
              <i class="glyphicon glyphicon-remove"></i>
            </a>
          </span>
        </div>
        <hr />
      </div>

      <h4>&nbsp;</h4>

      <a ng-if="vt.template.selectedOptions.fieldtype" href="javascript:;" class="save-now pull-right" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this field?<br><br>It will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="vt.template.deleteField(vt.template, vt.template.selectedOptions, vt.tempForm)">Delete Field</a>

      <a ng-if="!vt.template.selectedOptions.fieldtype" href="javascript:;" class="save-now pull-right" ng-bootbox-confirm="<center><h4>Are you sure you want to remove this section from the page?<br><br>The section's columns and fields will also be deleted and this is not reversible.</h4></center>" ng-bootbox-confirm-action="vt.template.deleteSection(vt.template, vt.template.selectedOptions, vt.tempForm)">Delete Section</a>

    </div>
  </div>

</div>