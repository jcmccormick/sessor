<nav id="page-menu" class="navbar navbar-inverse">
  <div class="navbar-header">
    <ul class="nav navbar-left top-nav">
      <li class="dropdown">
        <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-file"></i> Pages <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="#/templates/new"><i class="glyphicon glyphicon-plus"></i> &nbsp; New</a></li>
          <li><a href="#/templates"><i class="glyphicon glyphicon-search"></i> &nbsp; View All</a></li>
          <li class="divider"></li>
          <li><a href ng-bootbox-confirm="<center><h4>Are you sure you want to delete this page?<br> All work will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="deleteTemplate()"><i class="glyphicon glyphicon-trash text-danger"></i> &nbsp; Delete</a></li>
        </ul>
      </li>
      <li><a href ng-click="saveTemplate()"><i class="glyphicon glyphicon-save"></i> Finish</a></li>
      <li><a href ng-click="saveTemplate('temp')"><i class="glyphicon glyphicon-floppy-disk"></i> Save</a></li>
      <li class="dropdown">
        <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-plus"></i> Insert <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href data-toggle="modal" data-target=".newSectionModal"><i class="glyphicon glyphicon-modal-window"></i> &nbsp; Section</a></li>
          <li class="divider"></li>
          <li ng-repeat="type in fieldTypes"><a href ng-click="setFieldType(type)" ng-class="{disabled:template.sections.length<1}" data-toggle="modal" data-target=".newFieldModal"><i class="glyphicon {{type.glyphicon}}"></i> &nbsp; {{type.value}}</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-cog"></i> Options <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><span>Page</span></li>
          <li><span><label for="hideName"><input type="checkbox" id="hideName" name="hideName" ng-model="hideName"> Hide Name</span></li>
          <li><span><label for="template_draft"><input type="checkbox" id="template_draft" name="template_draft" ng-model="template.draft"> Draft</label></span></li>
          <li class="divider"></li>
          <li><span>Sharing</span></li>
          <li><span><label for="private_world"><input type="checkbox" id="private_world" name="private_world" ng-model="template.private_world"> Share Public</label></span></li>
          <li><span><label for="private_group"><input type="checkbox" id="private_group" name="private_group" ng-model="template.private_group"> Share Group</label></span></li>
          <li ng-if="template.private_group == 1" class="divider"></li>
          <li ng-if="template.private_group == 1"><span>Group</span></li>
          <li ng-if="template.private_group == 1"><span><label for="group_edit"><input type="checkbox" id="group_edit" name="group_edit" ng-model="template.group_edit"> Allow Editing</label></span></li>
          <li ng-if="template.group_edit"><span>Editors</span></li>
          <li ng-if="template.group_edit"><span><a role="button">Add</a> / <a role="button">Remove</a></span></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

<!-- BEGIN MODALS -->


<!-- BEGIN NEW SECTION MODAL -->
<div class="modal fade newSectionModal" tabindex="-1" role="dialog" aria-labelledby="newSectionModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Section Design</h4>
      </div>
      <div class="modal-body">
        <label class="control-label">Section Title</label>
        <input type="text" class="form-control" ng-model="newSectionName" value="{{section_name}}">

        <label class="control-label">Number of Columns</label>
        <ul class="btn-group btn-group-justified list-unstyled">
          <li class="btn btn-default" data-dismiss="modal" ng-repeat="column in columnTypes" ng-click="addNewSection(newSectionName, column.id)">
            {{column.id}}
          </li>
        </ul>
      </div>
      <div class="modal-footer">
        <!-- <button type="button" class="btn btn-success" ng-click="">Create Section</button> -->  
      </div>
    </form>
  </div>
</div>
<!-- END NEW SECTION MODAL -->

<!-- BEGIN NEW FIELD MODAL -->
<div class="modal fade newFieldModal" tabindex="-1" role="dialog" aria-labelledby="newFieldModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form name="newFieldForm" class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Field Design</h4>
      </div>
      <div class="modal-body">
        <label class="control-label">Field Name</label>
        <input type="text" class="form-control" ng-model="newFieldName" required>

        <label class="control-label">Section</label>
        <select class="form-control" ng-model="newFieldSection" ng-options="key as value for (key, value) in template.sections"></select>
        
        <label ng-if="newFieldSection && newFieldSection+1>0" class="control-label">Column</label>
        <ul ng-if="newFieldSection && newFieldSection+1>0" class="btn-group btn-group-justified list-unstyled">
          <li class="btn btn-default" data-dismiss="modal" ng-click="addNewField(template, 1*newFieldSection+1, $index+1, newFieldType, newFieldName)" ng-repeat="column_id in countColumns(template.columns[newFieldSection]) track by $index">
            Column {{$index+1}}
          </li>
        </ul>
      </div>
    </form>
  </div>
</div>
<!-- END NEW FIELD MODAL -->


<!-- END MODALS -->

<div ng-if="!hideName" class="paper">
  <!-- BEGIN FORM NAME INPUT -->
  <h3>Page Name</h3>
  <input type="text" class="form-control" ng-model="template.name" placeholder="Start with a name then press Save..."/>
  <!-- END FORM NAME INPUT -->
</div>

<div ng-if="template.sections.length>0">
  <template-form-directive form="template"></template-form-directive>
</div>

<div ng-if="template.idz">
  <h3>Sections
    <sup>
      <small>
        <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" data-html="true" title="Sections" data-content="<p>Open and close sections by clicking on the title area</p><p>Click and drag titles to reorder sections.</p>" data-container="body"></i>
      </small>
    </sup>
  </h3>
</div>

<!-- START MAIN SECTION REPEATING -->
<div ng-if="template.idz" role="tablist" sortable-list="template.sections" class="panel-group panel-carat" id="section-accordion">
  <div panel-hide class="panel panel-default" ng-repeat="(section_id, section_name) in template.sections track by $index">


    <!-- BEGIN SECTION HEADER -->
    <div class="panel-heading template-section-header"
    ng-class="{'collapsed':!$first}"
    data-toggle="collapse" 
    data-target="#sec{{section_id+1}}" 
    data-parent="#section-accordion" 
    aria-controls="sec{{section_id+1}}"
    id="section-accordion-header">
      <h4 class="panel-title">
        {{section_name}}
      </h4>
    </div>
    <!-- END SECTION HEADER -->


    <!-- BEGIN SECTION INFO PANEL -->
    <div role="tabpanel" id="sec{{section_id+1}}" class="panel-collapse collapse section-panel" aria-labelledby="heading{{section_id+1}}-tab" ng-class="{'active in':$first}">
      <div class="panel-body" bs-popover>

        <!-- BEGIN SECTION AND COLUMN DETAILS -->
        <p class="input-group">
          <input type="text" class="form-control" ng-model="section_name" value="{{section_name}}" placeholder="Enter a section name...">
          <span class="input-group-btn">
            <button class="btn btn-danger" data-toggle="collapse" data-target="#sec{{section_id+1}}" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this section?</h4></center>" ng-bootbox-confirm-action="deleteSection(template, section_name)">
              <i class="glyphicon glyphicon-trash"></i>
            </button>
          </span>
        </p>
        <!-- END SECTION AND COLUMN DETAILS -->


        <!-- BEGIN COLUMN REPEATING -->
        <div class="tab-content">
          <div role="tabpanel" 
          id="sec{{section_id+1}}col{{$index+1}}" 
          class="tab-pane fade column-preview-wrap" 
          ng-class="{'active in':$first}" 
          aria-labeledby="sec{{section_id+1}}col{{$index+1}}-tab" 
          ng-repeat="column in countColumns(template.columns[section_id]) track by $index">
            


            <!-- BEGIN FIELD REPEATING -->
            <div role="tablist" class="panel-group" id="field-accordion-sec{{section_id+1}}col{{$index+1}}">
              <div class="panel panel-default" ng-repeat="field in template.fields | filter:{section_id: section_id+1, column_id: $index+1}">


                <!-- BEGIN FIELD HEADER -->
                <div class="panel-heading" 
                data-toggle="collapse" 
                data-target="#sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}" 
                data-parent="#field-accordion-sec{{section_id+1}}col{{$parent.$index+1}}" 
                aria-controls="sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}" 
                id="sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}-header">
                  <h4 class="panel-title">
                    <i class="glyphicon {{field.glyphicon}}"></i>
                    {{field.name}}
                  </h4>
                </div>
                <!-- END FIELD HEADER -->


                <!-- BEGIN FIELD ACCORDION -->
                <div role="tabpanel" id="sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}" ng-class="{'in':$first}" class="panel-collapse collapse" aria-labelledby="sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}-tab">
                  <div class="panel-body">


                    <!-- BEGIN FIELD ACCORDION LEFT SIDE -->
                    <div class="col-xs-6" bs-popover>
                        <div class="form-group">
                            <label class="control-label">Field Title</label>
                            <input type="text" class="form-control" ng-model="field.name">
                        </div>

                        <div class="form-group" ng-hide="field.fieldtype == 'checkbox' || field.fieldtype == 'radio'">
                            <label class="control-label">Field Default Value</label>
                            <input type="{{field.fieldtype}}" class="form-control" ng-model="field.values[0].input">
                        </div>

                        <div class="form-group">
                            <label class="control-label"><input type="checkbox" ng-model="field.required"/> Required?</label>
                        </div>

                        <div class="form-group">
                            <label class="control-label"><input type="checkbox" ng-model="field.disabled"/> Disabled?</label>
                        </div>
                    </div>
                    <!-- END FIELD ACCORDION LEFT SIDE -->


                    <!-- BEGIN FIELD ACCORDION RIGHT SIDE -->
                    <div class="col-xs-6">
                      <div class="form-group" ng-show="field.fieldtype == 'radio' || field.fieldtype == 'dropdown'">
                        <label class="control-label">Field Options</label>
                        <div class="control-input">
                          <button class="btn btn-primary btn-sm" type="button" ng-click="addOption(field)"> Add Option</button><br><br>
                          <p class="input-group" ng-repeat="option in field.options">
                            <input type="text" class="form-control" ng-model="option.name" value="{{option.name}}">
                            <span class="input-group-btn">
                              <button class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this option?</h4></center>" ng-bootbox-confirm-action="deleteOption(field, option)">
                                <i class="glyphicon glyphicon-remove"></i>
                              </button>
                            </span>
                          </p>
                        </div>
                      </div>
                    </div>
                    <!-- END FIELD ACCORDION RIGHT SIDE -->


                    <!-- BEGIN FIELD ACCORDION FOOTER -->
                    <div class="col-md-12 col-sm-12 col-xs-12">
                      <button type="button" class="btn btn-danger h1" data-toggle="collapse" data-target="#sec{{section_id+1}}col{{$parent.$index+1}}field{{field.id}}" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this field?</h4></center>" ng-bootbox-confirm-action="deleteField(column, field)">Delete Field</button>
                    </div>
                    <!-- END FIELD ACCORDION FOOTER -->


                  </div>
                </div>
                <!-- END FIELD ACCORDION -->


              </div>
            </div>
            <!-- END FIELD REPEATING -->


            <!-- BEGIN COLUMN PREVIEW -->
<!--             <div role="tablist" class="panel-group" id="column-preview-accordion">
              <div class="panel panel-default">


                <div class="panel-heading" 
                data-toggle="collapse" 
                data-target="#sec{{section_id+1}}col{{$index+1}}-preview-panel" 
                data-parent="#column-preview-accordion" 
                aria-controls="sec{{section_id+1}}col{{$index+1}}-preview-panel" 
                id="column-preview-panel-header">
                  <h4 class="panel-title" bs-popover>
                    <i class="glyphicon glyphicon-search"></i>
                    Column Preview 
                    <sup>
                      <small>
                        <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" title="Column Preview" data-content="Click to view a live preview of the currently selected column. Any data entered into the fields below will be used as their default values when entering reports." data-placement="top" data-container="body"></i>
                      </small>
                    </sup>
                  </h4>
                </div>


                <div role="tabpanel" id="sec{{section_id+1}}col{{$index+1}}-preview-panel" class="panel-collapse collapse" aria-labelledby="sec{{section_id+1}}col{{$index+1}}-preview-panel-tab">
                  <div class="panel-body">
                    <template-field-directive ng-repeat="field in column.fields" field="field"></template-field-directive>
                  </div>
                </div>


              </div>
            </div> -->
            <!-- END COLUMN PREVIEW -->


          </div>
        </div>
        <!-- END COLUMN REPEATING -->


      </div> 
    </div>
    <!-- END SECTION INFO PANEL -->


  </div>
</div>
<!-- END MAIN SECTION REPEATING -->