<h1 class="page-header">Template Builder</h1>

<!-- BEGIN FORM NAME INPUT -->
<h3>Title
  <sup>
    <small>
      <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" data-title="Title" data-html="true" data-content="<p>The title of your template should quickly explain a purpose to your user.</p><p>Ex:</p><pre>In-Person Math Tutoring<br>Patient Intake<br>Daily Exercise</pre>" data-container="body"></i>
    </small>
  </sup>
</h3>
<p ng-show="template.name == ''"></p>
<p class="has-feedback">
    <input type="text" class="form-control" ng-model="template.name" placeholder="Enter a title..." />
    <i class="glyphicon glyphicon-pencil form-control-feedback"></i>
</p>
<!-- END FORM NAME INPUT -->


<!-- BEGIN SECTION AND PREVEIW BUTTONS -->
<div class="stick col-xs-9 col-sm-6 col-md-6">
  <div class="btn-group btn-group-justified" ng-disabled="template.name != ''">
    <a role="button" class="btn btn-info" ng-click="saveTemplate()">Finish</a>
    <a role="button" class="btn btn-info" ng-click="saveDraft()">Draft</a>
    <a role="button" class="btn btn-info" data-toggle="modal" data-target=".previewModal" ng-click="previewUpdate()">Preview</a>
    <a type="button" class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to reset the entire template?<br> All unsaved or undrafted work will be permanently deleted.</h4></center>" ng-bootbox-confirm-action="resetTemplate()">Reset</a>
  </div>
</div>
<!-- END SECTION AND PREVEIW BUTTONS -->


<!-- BEGIN MODALS -->


<!-- BEGIN PREVIEW MODAL -->
<div class="modal fade previewModal" tabindex="-1" role="dialog" aria-labelledby="previewModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Template Preview</h4>
      </div>
      <div class="modal-body row">
        <div class="col-md-12">
          <template-form-directive form="previewTemplate"></template-form-directive>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" data-dismiss="modal" aria-label="Return">Return</button>  
      </div>
    </form>
  </div>
</div>
<!-- END PREVIEW MODAL -->


<!-- BEGIN NEW SECTION MODAL -->
<div class="modal fade newSectionModal" tabindex="-1" role="dialog" aria-labelledby="newSectionModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <form class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-header">
        <h4 class="modal-title">Section Design</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <div role="tablist" class="panel-group" id="new-section-accordion">
            <div class="panel panel-default">
              <div class="panel-heading" data-toggle="collapse" data-target="#column-list" data-parent="#new-section-accordion" aria-controls="column-list" id="column-list-header">
                <h4 class="panel-title">
                  Select Columns and Create New
                </h4>
              </div>
              <div role="tabpanel" id="column-list" class="panel-collapse collapse" aria-labelledby="column-list-tab">
                <div class="panel-body">
                  <label class="control-label">Section Title</label>
                  <input type="text" class="form-control" ng-model="addSection.name" value="{{section.name}}">
                  <div class="btn btn-default h6" ng-repeat="column in addColumn.types" data-dismiss="modal" data-toggle="collapse" data-target="#column-list" ng-click="addNewSection(column)">
                    <h4>{{column.id}} <ng-pluralize count="column.id" when="{'one': 'column', 'other': 'columns'}"></ng-pluralize></h4>
                    <div class="btn-group btn-group-justified">
                      <div class="{{column.width}}" aria-label="Select from one to three columns" ng-repeat="but in addColumn.types|limitTo:column.id">Column {{but.id}}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <h3 class="text-center">OR</h3>
            <div class="panel panel-default">
              <div class="panel-heading" data-toggle="collapse" data-target="#section-list" data-parent="#new-section-accordion" aria-controls="section-list" id="section-list-header">
                <h4 class="panel-title">
                  Select Premade Section
                </h4>
              </div>
              <div role="tabpanel" id="section-list" class="panel-collapse collapse" aria-labelledby="section-list-tab">
                <div class="panel-body">
                  <div ng-repeat="premadeSection in addSection.types">
                    <button class="btn btn-default" aria-label="Select a premade section" data-dismiss="modal" data-toggle="collapse" data-target="#section-list" ng-click="addPremadeSection(premadeSection)">Add Section</button>
                    <div class="{{column.width}}" ng-repeat="column in premadeSection.columns">
                      <h4>Column {{column.id+1}}</h4>
                      <template-field-directive ng-repeat="field in column.fields" field="field"></template-field-directive>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <!-- <button type="button" class="btn btn-success" ng-click="">Create Section</button> -->  
      </div>
    </form>
  </div>
</div>
<!-- END NEW SECTION MODAL -->


<!-- END MODALS -->

<div ng-show="template.name != ''">
  <h3>Sections
    <sup>
      <small>
        <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" data-html="true" title="Sections" data-content="<p>Sections are the core of your template. Consider focusing them on specific topics.</p><p>Click and drag section headers to reorder.</p>" data-container="body"></i>
      </small>
    </sup>
  </h3>
  <p>
    <a role="button" class="btn btn-primary" data-toggle="modal" data-target=".newSectionModal">Add Section</a>
  </p>
</div>

<!-- START MAIN SECTION REPEATING -->
<div role="tablist" ui-sortable ng-model="template.sections" class="panel-group panel-carat" id="section-accordion">
  <div class="panel panel-info" ng-repeat="section in template.sections track by $index">


    <!-- BEGIN SECTION HEADER -->
    <div class="panel-heading template-section-header"
    ng-class="{'collapsed':!$first}"
    data-toggle="collapse" 
    data-target="#collapse{{section.id}}" 
    data-parent="#section-accordion" 
    aria-controls="collapse{{section.id}}">
      {{section.name}}
    </div>
    <!-- END SECTION HEADER -->


    <!-- BEGIN SECTION INFO PANEL -->
    <div role="tabpanel" id="collapse{{section.id}}" class="panel-collapse collapse" aria-labelledby="heading{{section.id}}-tab" ng-class="{'active in':$first}">
      <div class="panel-body" bs-popover>


        <!-- BEGIN SECTION AND COLUMN DETAILS -->
        <h3>Section Title</h3>
        <div class="input-group">
          <input type="text" class="form-control" ng-model="section.name" value="{{section.name}}">
          <span class="input-group-btn">
            <button class="btn btn-danger" data-toggle="collapse" data-target="#collapse{{section.id}}" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this section?</h4></center>" ng-bootbox-confirm-action="deleteSection(template, section)">Delete Section</button>
          </span>
        </div>
        <hr>        
        <h3>
          Columns and Fields
          <sup>
            <small>
              <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" title="Columns and Fields" data-html="true" data-content="<p>Switch columns with a single click. Hover over the white and green icons to see details about each field type and click to add.</p><p>Click and drag field headers to reorder.</p>" data-placement="bottom" data-container="body"></i>
            </small>
          </sup>
        </h3>
        <!-- END SECTION AND COLUMN DETAILS -->


        <!-- BEGIN COLUMN LIST -->
        <ul role="tablist" class="btn-group btn-group-justified list-unstyled">
          <li role="presentation" class="btn btn-default" ng-class="{'active in':$first}" ng-repeat="column in section.columns" aria-controls="sec{{section.id}}col{{column.id}}" data-target="#sec{{section.id}}col{{column.id}}" data-toggle="tab">
            Column {{column.id+1}}
          </li>
        </ul>
        <!-- END COLUMN LIST -->
        

        <!-- BEGIN COLUMN REPEATING -->
        <div class="tab-content">
          <div role="tabpanel" 
          id="sec{{section.id}}col{{column.id}}" 
          class="tab-pane fade column-preview-wrap" 
          ng-class="{'active in':$first}" 
          aria-labeledby="sec{{section.id}}col{{column.id}}-tab" 
          ng-repeat="column in section.columns">
            

            <!-- BEGIN COLUMN FIELD LIST -->
            <div id="input-fields" class="h4 text-center btn-group btn-group-justified">
              <label class="btn btn-success" ng-bootbox-prompt="Please enter a name for this {{type.value}}" ng-bootbox-prompt-action="addNewField(column, type, result)" bs-popover ng-repeat="type in addField.types">
                <i class="glyphicon {{type.glyphicon}}" id="{{type.name}}" rel="popover" data-content="{{type.value}}" data-placement="top" data-container="body"></i>
              </label>
            </div>
            <!-- END COLUMN FIELD LIST -->


            <!-- BEGIN FIELD REPEATING -->
            <div role="tablist" ui-sortable="sortableOptions" ng-model="column.fields" class="panel-group" id="field-accordion-sec{{section.id}}col{{column.id}}">
              <div class="panel panel-success" ng-repeat="field in column.fields track by $index">


                <!-- BEGIN FIELD HEADER -->
                <div class="panel-heading" 
                data-toggle="collapse" 
                data-target="#sec{{section.id}}col{{column.id}}field{{field.id}}" 
                data-parent="#field-accordion-sec{{section.id}}col{{column.id}}" 
                aria-controls="sec{{section.id}}col{{column.id}}field{{field.id}}" 
                id="sec{{section.id}}col{{column.id}}field{{field.name}}">
                  <h4 class="panel-title">
                    <i class="glyphicon {{field.glyphicon}}"></i>
                    {{field.name}}
                  </h4>
                </div>
                <!-- END FIELD HEADER -->


                <!-- BEGIN FIELD ACCORDION -->
                <div role="tabpanel" id="sec{{section.id}}col{{column.id}}field{{field.id}}" ng-class="{'in':$first}" class="panel-collapse collapse" aria-labelledby="sec{{section.id}}col{{column.id}}field{{field.id}}-tab">
                  <div class="panel-body">


                    <!-- BEGIN FIELD ACCORDION LEFT SIDE -->
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <div class="form-group">
                            <label class="control-label">Field Title</label>
                            <input type="text" class="form-control" ng-model="field.name" value="{{field.name}}">
                        </div>

                        <div class="form-group" ng-hide="field.type == 'date'">
                            <label class="control-label">Field Default Value</label>
                            <input class="form-control" type="text" ng-model="field.value" value="{{field.value}}">
                        </div>

                        <div class="form-group">
                            <label class="control-label"><input type="checkbox" ng-value="true" ng-selected ng-model="field.required"/> Required?</label>
                        </div>

                        <div class="form-group">
                            <label class="control-label"><input type="checkbox" ng-value="true" ng-selected ng-model="field.disabled"/> Disabled?</label>
                        </div>
                    </div>
                    <!-- END FIELD ACCORDION LEFT SIDE -->


                    <!-- BEGIN FIELD ACCORDION RIGHT SIDE -->
                    <div class="col-md-6 col-sm-6 col-xs-6">
                      <div class="form-group" ng-show="field.type == 'radio' || field.type == 'dropdown'">
                        <label class="control-label">Field Options</label>
                        <div class="control-input">
                          <button class="btn btn-primary btn-sm" type="button" ng-click="addOption(field)"> Add Option</button><br><br>
                          <p class="input-group" ng-repeat="option in field.options">
                            <input type="text" class="form-control" ng-model="option.name" value="{{option.name}}">
                            <span class="input-group-btn">
                              <button class="btn btn-danger" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this option?</h4></center>" ng-bootbox-confirm-action="deleteOption(field, option)">
                                <i class="glyphicon glyphicon-remove"></i>
                              </button>
                            </span>
                          </p>
                        </div>
                      </div>
                    </div>
                    <!-- END FIELD ACCORDION RIGHT SIDE -->


                    <!-- BEGIN FIELD ACCORDION FOOTER -->
                    <div class="col-md-12 col-sm-12 col-xs-12">
                      <button type="button" class="btn btn-danger h1" data-toggle="collapse" data-target="#sec{{section.id}}col{{column.id}}field{{field.id}}" ng-bootbox-confirm="<center><h4>Are you sure you want to delete this field?</h4></center>" ng-bootbox-confirm-action="deleteField(column, field)">Delete Field</button>
                    </div>
                    <!-- END FIELD ACCORDION FOOTER -->


                  </div>
                </div>
                <!-- END FIELD ACCORDION -->


              </div>
            </div>

            <!-- BEGIN COLUMN PREVIEW -->
            <div class="column-preview {{column.width}}" id="column-preview" ng-show="column.fields.length > 0" bs-popover>
              <h4>
                Column Preview 
                <sup>
                  <small>
                    <i class="glyphicon glyphicon-flash" rel="popover" data-trigger="hover" title="Column Preview" data-content="This is a live preview of the currently selected column. Any data entered below will be used as the default value for its respective field." data-placement="bottom" data-container="body"></i>
                  </small>
                </sup>
              </h4>
              <template-field-directive ng-repeat="field in column.fields" field="field"></template-field-directive>
            </div>
            <!-- END COLUMN PREVIEW -->
          </div>
        </div>
        <!-- END COLUMN REPEATING -->
      </div> 
    </div>
  </div>
</div>


<div ng-show="template.sections.length > 0">
  <a class="btn btn-primary" ng-show="!showJson" ng-click="showJson = true">Show form json object</a>
  <a class="btn btn-inverse" ng-show="showJson" ng-click="showJson = false">Hide form json object</a><br><br>
</div>

<div ng-show="showJson">
  <h4>Template object content:</h4>
  <pre>{{ template | json }}</pre>
</div>